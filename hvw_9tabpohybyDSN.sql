USE [RayService]
GO

/****** Object:  View [dbo].[hvw_9tabpohybyDSN]    Script Date: 03.07.2025 12:47:39 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE VIEW [dbo].[hvw_9tabpohybyDSN] AS SELECT T.ID,
T.SumaKc1, T.SumaKc2, T.SumaKc3, T.SumaKc4, T.SumaKc5, T.SumaKc6, T.SumaKc7, T.Celkem,
CASE WHEN T.DP IN(1,2,4,9,10,11,14,19,25,26) THEN -T.SumaKc1 ELSE T.SumaKc1 END AS Kc1Druh,
CASE WHEN T.DP IN(1,2,4,9,10,11,14,19,25,26) THEN -T.SumaKc2 ELSE T.SumaKc2 END AS Kc2Druh,
CASE WHEN T.DP IN(1,2,4,9,10,11,14,19,25,26) THEN -T.SumaKc3 ELSE T.SumaKc3 END AS Kc3Druh,
CASE WHEN T.DP IN(1,2,4,9,10,11,14,19,25,26) THEN -T.SumaKc4 ELSE T.SumaKc4 END AS Kc4Druh,
CASE WHEN T.DP IN(1,2,4,9,10,11,14,19,25,26) THEN -T.SumaKc5 ELSE T.SumaKc5 END AS Kc5Druh,
CASE WHEN T.DP IN(1,2,4,9,10,11,14,19,25,26) THEN -T.SumaKc6 ELSE T.SumaKc6 END AS Kc6Druh,
CASE WHEN T.DP IN(1,2,4,9,10,11,14,19,25,26) THEN -T.SumaKc7 ELSE T.SumaKc7 END AS Kc7Druh,
CASE WHEN T.DP IN(1,2,4,9,10,11,14,19,25,26) THEN -T.Celkem  ELSE T.Celkem  END AS KcCelkemDruh
FROM (SELECT P.ID, MIN(P.DruhPohybuZbo) AS DP,
CAST(SUM(O.SumaKc1) AS NUMERIC(19,6)) AS SumaKc1,
CAST(SUM(O.SumaKc2) AS NUMERIC(19,6)) AS SumaKc2,
CAST(SUM(O.SumaKc3) AS NUMERIC(19,6)) AS SumaKc3,
CAST(SUM(O.SumaKc4) AS NUMERIC(19,6)) AS SumaKc4,
CAST(SUM(O.SumaKc5) AS NUMERIC(19,6)) AS SumaKc5,
CAST(SUM(O.SumaKc6) AS NUMERIC(19,6)) AS SumaKc6,
CAST(SUM(O.SumaKc7) AS NUMERIC(19,6)) AS SumaKc7,
CAST(SUM(O.Celkem)  AS NUMERIC(19,6)) AS Celkem
FROM TabPohybyZbozi AS P
LEFT OUTER JOIN TabPohybySN  AS O ON O.IDPohyb = P.ID
LEFT OUTER JOIN TabDokladySN AS S ON S.ID = O.IDDoklad 
where S.Realizovano = 1
GROUP BY P.ID) AS T
GO

