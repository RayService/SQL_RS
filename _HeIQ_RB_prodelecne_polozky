(SELECT CASE   WHEN ROUND(tpz.JCbezDaniKc/NULLIF(tzk.Celkem,0),4)<1.4 AND tkze._KalSkup='A-TOP' THEN 255  WHEN ROUND(tpz.JCbezDaniKc/NULLIF(tzk.Celkem,0),4)<1.3 AND tkze._KalSkup='B-Optimal' THEN 65535  WHEN ROUND(tpz.JCbezDaniKc/NULLIF(tzk.Celkem,0),4)<1.2 AND tkze._KalSkup='C-LowProfit' THEN 65408  WHEN ROUND(tpz.JCbezDaniKc/NULLIF(tzk.Celkem,0),4)<1.3 AND tkze._KalSkup IS NULL THEN 16711935  ELSE NULL END AS INT  FROM TabPohybyZbozi tpz WITH(NOLOCK)  LEFT OUTER JOIN TabKmenZbozi tkz WITH(NOLOCK) ON tkz.ID=(SELECT TabStavSkladu.IDKmenZbozi FROM TabStavSkladu WHERE TabStavSkladu.ID=tpz.IDZboSklad)  LEFT OUTER JOIN TabKmenZbozi_EXT tkze WITH(NOLOCK) ON tkze.ID=tkz.ID  LEFT OUTER JOIN TabZKalkulace tzk ON tzk.Dilec=  (SELECT tkz.ID FROM TabPohybyZbozi TP WITH(NOLOCK)  LEFT OUTER JOIN TabKmenZbozi tkz WITH(NOLOCK) ON tkz.ID=(SELECT TabStavSkladu.IDKmenZbozi FROM TabStavSkladu WITH(NOLOCK) WHERE TabStavSkladu.ID=TP.IDZboSklad)  WHERE TP.ID=tpz.ID)  AND  EXISTS  (SELECT *   FROM TabCZmeny Zod WITH(NOLOCK)  LEFT OUTER JOIN TabCZmeny Zdo WITH(NOLOCK) ON (ZDo.ID=tzk.zmenaDo)   WHERE Zod.ID=tzk.zmenaOd AND Zod.platnostTPV=1 AND Zod.datum<=GETDATE() AND (tzk.ZmenaDo IS NULL OR Zdo.platnostTPV=0 OR (ZDo.platnostTPV=1 AND ZDo.datum>GETDATE())))  WHERE tpz.ID=TabPohybyZbozi.ID)
