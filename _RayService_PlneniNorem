(CASE WHEN (SELECT ISNULL(SUM(MZ.Sk_cas_H),0)      FROM TabPrikazMzdyAZmetky MZ WITH(NOLOCK)     LEFT OUTER JOIN TabCPraco tcpr WITH(NOLOCK) ON tcpr.ID=MZ.IDPracoviste     LEFT OUTER JOIN TabCPraco_EXT WITH(NOLOCK) ON TabCPraco_EXT.ID=tcpr.ID     WHERE MZ.IDPrikaz=TabPrPostup.IDPrikaz AND MZ.DokladPrPostup=TabPrPostup.Doklad AND MZ.AltPrPostup=TabPrPostup.Alt AND MZ.stav=1 AND (MZ.IDTabStrom=N'200' OR      (tcpr.IDTabStrom LIKE N'2002%'AND (ISNULL(TabCPraco_EXT._EXT_RS_wokplaceQA,0)=0 AND ISNULL(TabCPraco_EXT._EXT_RS_workplaceWH,0)=0))))=0 THEN 0  ELSE  (  SELECT (SUM((PP.Kusy_zad * PP.TAC_H)+PP.TBC_H+PP.TEC_H))  FROM TabPrPostup PP WITH(NOLOCK)  LEFT JOIN TabCPraco WITH(NOLOCK) ON TabCPraco.ID=PP.Pracoviste  LEFT OUTER JOIN TabCPraco_EXT WITH(NOLOCK) ON TabCPraco_EXT.ID=TabCPraco.ID  WHERE (TabCPraco.IDTabStrom=N'200' OR (TabCPraco.IDTabStrom LIKE N'2002%'AND (ISNULL(TabCPraco_EXT._EXT_RS_wokplaceQA,0)=0 AND ISNULL(TabCPraco_EXT._EXT_RS_workplaceWH,0)=0))) AND PP.ID=TabPrPostup.ID AND PP.IDOdchylkyDo IS NULL AND PP.prednastaveno=1  )  /  (SELECT ISNULL(SUM(MZ.Sk_cas_H) ,0)  FROM TabPrikazMzdyAZmetky MZ WITH(NOLOCK)  LEFT OUTER JOIN TabCPraco tcpr WITH(NOLOCK) ON tcpr.ID=MZ.IDPracoviste  LEFT OUTER JOIN TabCPraco_EXT WITH(NOLOCK) ON TabCPraco_EXT.ID=tcpr.ID  WHERE MZ.IDPrikaz=TabPrPostup.IDPrikaz AND MZ.DokladPrPostup=TabPrPostup.Doklad AND MZ.AltPrPostup=TabPrPostup.Alt AND MZ.stav=1 AND (MZ.IDTabStrom=N'200' OR (tcpr.IDTabStrom LIKE N'2002%'AND (ISNULL(TabCPraco_EXT._EXT_RS_wokplaceQA,0)=0 AND ISNULL(TabCPraco_EXT._EXT_RS_workplaceWH,0)=0))))  *100  END)
