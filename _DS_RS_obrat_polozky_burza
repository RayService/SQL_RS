(    SELECT ISNULL(  (  SELECT CASE WHEN  (SELECT TP.mnozstvi * AVG(PZ.JCBezDaniKC)  FROM TabPlan TP WITH(NOLOCK)  INNER JOIN TabPlanZdrojOZ TPZ ON TPZ.IDPlan = TP.ID  JOIN TabPohybyZbozi PZ WITH(NOLOCK) ON TPZ.IDRezervace = PZ.ID  JOIN TabDokladyZbozi TD WITH(NOLOCK) ON TD.ID = PZ.IDDoklad  WHERE TP.ID = TabPlan.ID  GROUP BY TP.ID, TP.mnozstvi) IS NULL  THEN  (SELECT  SUM(tppp.Kusy_zad * tppp.TAC_S / 3600.0)*2300  FROM TabPlan tp WITH(NOLOCK)    LEFT OUTER JOIN TabPlanPrikaz tpp WITH(NOLOCK) ON tpp.IDPlan = tp.ID    LEFT OUTER JOIN TabPlanPrPostup tppp WITH(NOLOCK) ON tppp.IDPlanPrikaz = tpp.ID    LEFT OUTER JOIN TabCPraco tcp WITH(NOLOCK) ON tppp.Pracoviste=tcp.ID  WHERE (tcp.IDTabStrom = '200' OR tcp.IDTabStrom LIKE N'2002%') AND tp.ID = TabPlan.ID)  ELSE  (SELECT TP.mnozstvi * AVG(PZ.JCBezDaniKC)  FROM TabPlan TP WITH(NOLOCK)  INNER JOIN TabPlanZdrojOZ TPZ ON TPZ.IDPlan = TP.ID  JOIN TabPohybyZbozi PZ WITH(NOLOCK) ON TPZ.IDRezervace = PZ.ID  JOIN TabDokladyZbozi TD WITH(NOLOCK) ON TD.ID = PZ.IDDoklad  WHERE TP.ID = TabPlan.ID  GROUP BY TP.ID, TP.mnozstvi)  END),  (  SELECT CASE WHEN  (SELECT TPE._EXT_RS_mnozstvi_obchod * AVG(PZ.JCBezDaniKC)  FROM TabPlan TP WITH(NOLOCK)  LEFT OUTER JOIN TabPlan_EXT TPE WITH(NOLOCK) ON TPE.ID = TP.ID  INNER JOIN TabPlanZdrojOZ TPZ ON TPZ.IDPlan = TPE._EXT_RS_ID_plan_presun  JOIN TabPohybyZbozi PZ WITH(NOLOCK) ON TPZ.IDRezervace = PZ.ID  JOIN TabDokladyZbozi TD WITH(NOLOCK) ON TD.ID = PZ.IDDoklad  WHERE TP.ID = TabPlan.ID  GROUP BY TP.ID, TPE._EXT_RS_mnozstvi_obchod) IS NULL  THEN  (SELECT  SUM(tppp.Kusy_zad * tppp.TAC_S / 3600.0)*2300  FROM TabPlan tp WITH(NOLOCK)    LEFT OUTER JOIN TabPlan_EXT TPE WITH(NOLOCK) ON TPE.ID = TP.ID    LEFT OUTER JOIN TabPlanPrikaz tpp WITH(NOLOCK) ON tpp.IDPlan = tp.ID    LEFT OUTER JOIN TabPlanPrPostup tppp WITH(NOLOCK) ON tppp.IDPlanPrikaz = tpp.ID    LEFT OUTER JOIN TabCPraco tcp WITH(NOLOCK) ON tppp.Pracoviste=tcp.ID  WHERE (tcp.IDTabStrom = '200' OR tcp.IDTabStrom LIKE N'2002%') AND tp.ID = TPE._EXT_RS_ID_plan_presun)  ELSE  (SELECT TPE._EXT_RS_mnozstvi_obchod * AVG(PZ.JCBezDaniKC)  FROM TabPlan TP WITH(NOLOCK)  LEFT OUTER JOIN TabPlan_EXT TPE WITH(NOLOCK) ON TPE.ID = TP.ID  INNER JOIN TabPlanZdrojOZ TPZ ON TPZ.IDPlan = TPE._EXT_RS_ID_plan_presun  JOIN TabPohybyZbozi PZ WITH(NOLOCK) ON TPZ.IDRezervace = PZ.ID  JOIN TabDokladyZbozi TD WITH(NOLOCK) ON TD.ID = PZ.IDDoklad  WHERE TP.ID = TabPlan.ID  GROUP BY TP.ID, TPE._EXT_RS_mnozstvi_obchod)  END))  )
