((select   (case when sum(isnull(tsse._rnsumaec,0))=0 then 0 else sum(isnull(tsse._rnprumstsklsn,0)*aparam.dnyobratu)/sum(isnull(tsse._rnsumaec,0)) end) -  (case when sum(isnull(tsse._rnsumaecmo,0))=0 then 0 else sum(isnull(tsse._rnprumstsklsnmo,0)*aparam.dnyobratu)/sum(isnull(tsse._rnsumaecmo,0)) end)   from tabstavskladu tss WITH(NOLOCK) left outer join tabstavskladu_ext tsse WITH(NOLOCK) on tsse.id=tss.id   left outer join tabkmenzbozi tkz WITH(NOLOCK) on tkz.id=tss.idkmenzbozi left outer join aparam on 1=1   left outer join tabstrom mm WITH(NOLOCK) on mm.cislo=tss.idsklad left outer  join tabstrom_ext mme WITH(NOLOCK) on mme.id=mm.id  where TabSortiment.id=tkz.idsortiment and mme._sapvyloucitznobratk is null))
