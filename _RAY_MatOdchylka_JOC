CASE  WHEN  (SELECT (( SELECT KZE._material * P.kusy_zad  FROM #TabPorPS PPS  LEFT OUTER JOIN TabPrikaz P WITH(NOLOCK) ON #TabPorPS.IDPrikaz=P.ID  LEFT OUTER JOIN TabKmenZbozi KZ  WITH(NOLOCK) ON PPS.IDKmenZbozi= KZ.ID    LEFT OUTER JOIN TabKmenZbozi_EXT KZE WITH(NOLOCK) ON KZ.ID= KZE.ID    WHERE PPS.Id = PPSS.Id) * 100 )     FROM  #TabPorPS  PPSS  WHERE PPSS.Id = #TabPorPS.Id  ) <>0  THEN (SELECT ((PPSS.mat - ( SELECT KZE._material * P.kusy_zad  FROM #TabPorPS PPS  LEFT OUTER JOIN TabPrikaz P WITH(NOLOCK) ON #TabPorPS.IDPrikaz=P.ID  LEFT OUTER JOIN TabKmenZbozi KZ  WITH(NOLOCK) ON PPS.IDKmenZbozi= KZ.ID    LEFT OUTER JOIN TabKmenZbozi_EXT KZE WITH(NOLOCK)  ON KZ.ID= KZE.ID    WHERE PPS.Id = PPSS.Id))/(( SELECT KZE._material * P.kusy_zad  FROM #TabPorPS PPS  LEFT OUTER JOIN TabPrikaz P WITH(NOLOCK) ON #TabPorPS.IDPrikaz=P.ID  LEFT OUTER JOIN TabKmenZbozi KZ  WITH(NOLOCK) ON PPS.IDKmenZbozi= KZ.ID    LEFT OUTER JOIN TabKmenZbozi_EXT KZE WITH(NOLOCK)  ON KZ.ID= KZE.ID    WHERE PPS.Id = PPSS.Id))) * 100     FROM  #TabPorPS  PPSS  WHERE PPSS.Id = #TabPorPS.Id  )  ELSE  NULL  END
