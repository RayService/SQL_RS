(  SELECT CASE   WHEN ROUND(tpz.JCbezDaniKc/(NULLIF(tzk.Celkem,0)*(1+((ISNULL(td.davka,1)*0.1)/NULLIF(tpz.Mnozstvi,0)))),4)<1.65 AND tkze._KalSkup='A-TOP' THEN 255  WHEN ROUND(tpz.JCbezDaniKc/(NULLIF(tzk.Celkem,0)*(1+((ISNULL(td.davka,1)*0.1)/NULLIF(tpz.Mnozstvi,0)))),4)<1.5 AND tkze._KalSkup='B-Optimal' THEN 65535  WHEN ROUND(tpz.JCbezDaniKc/(NULLIF(tzk.Celkem,0)*(1+((ISNULL(td.davka,1)*0.1)/NULLIF(tpz.Mnozstvi,0)))),4)<1.4 AND tkze._KalSkup='C-LowProfit' THEN 65408  WHEN ROUND(tpz.JCbezDaniKc/(NULLIF(tzk.Celkem,0)*(1+((ISNULL(td.davka,1)*0.1)/NULLIF(tpz.Mnozstvi,0)))),4)<1.5 AND tkze._KalSkup IS NULL THEN 16711935  ELSE NULL END AS INT  FROM TabPohybyZbozi tpz WITH(NOLOCK)  LEFT OUTER JOIN TabKmenZbozi tkz WITH(NOLOCK) ON tkz.ID=(SELECT TabStavSkladu.IDKmenZbozi FROM TabStavSkladu WHERE TabStavSkladu.ID=tpz.IDZboSklad)  LEFT OUTER JOIN TabKmenZbozi_EXT tkze WITH(NOLOCK) ON tkze.ID=tkz.ID  LEFT OUTER JOIN TabNC vnc WITH(NOLOCK) ON VNC.CenovaUroven = 200 AND VNC.IDKmenZbozi=tkz.ID  LEFT OUTER JOIN TabDavka td ON td.ID=(  SELECT TD.ID  FROM TabPohybyZbozi PZ WITH(NOLOCK)  INNER JOIN TabDokladyZbozi TDZ WITH(NOLOCK) ON TDZ.ID =PZ.IDDoklad  LEFT OUTER JOIN TabKmenZbozi KZ ON KZ.ID=(SELECT TabStavSkladu.IDKmenZbozi FROM TabStavSkladu WHERE TabStavSkladu.ID=PZ.IDZboSklad)  LEFT OUTER JOIN TabDavka TD WITH(NOLOCK) ON TD.IDDilce=KZ.ID  INNER JOIN TabCZmeny Zod WITH(NOLOCK) ON Zod.ID = TD.zmenaOd  LEFT OUTER JOIN TabCZmeny Zdo WITH(NOLOCK) ON ZDo.ID = TD.zmenaDo  WHERE PZ.ID = tpz.ID AND Zod.ID = TD.zmenaOd AND Zod.platnostTPV = 1 AND Zod.datum <= TDZ.DatPorizeni AND (TD.ZmenaDo IS NULL OR Zdo.platnostTPV=0 OR (ZDo.platnostTPV=1 AND ZDo.datum > TDZ.DatPorizeni))  )  LEFT OUTER JOIN TabZKalkulace tzk ON tzk.Dilec=  (SELECT tkz.ID FROM TabPohybyZbozi TP WITH(NOLOCK)  LEFT OUTER JOIN TabKmenZbozi tkz WITH(NOLOCK) ON tkz.ID=(SELECT TabStavSkladu.IDKmenZbozi FROM TabStavSkladu WITH(NOLOCK) WHERE TabStavSkladu.ID=TP.IDZboSklad)  WHERE TP.ID=tpz.ID)  AND  EXISTS  (SELECT *   FROM TabCZmeny Zod WITH(NOLOCK)  LEFT OUTER JOIN TabCZmeny Zdo WITH(NOLOCK) ON (ZDo.ID=tzk.zmenaDo)   WHERE Zod.ID=tzk.zmenaOd AND Zod.platnostTPV=1 AND Zod.datum<=GETDATE() AND (tzk.ZmenaDo IS NULL OR Zdo.platnostTPV=0 OR (ZDo.platnostTPV=1 AND ZDo.datum>GETDATE())))  WHERE tpz.ID=TabPohybyZbozi.ID  )
