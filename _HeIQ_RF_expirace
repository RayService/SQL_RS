CAST(CASE WHEN (SELECT COUNT(tdz.ID)  FROM TabPohybyZbozi tpz WITH(NOLOCK)  LEFT OUTER JOIN TabStavSkladu tss WITH(NOLOCK) ON tss.ID = tpz.IDZboSklad  LEFT OUTER JOIN TabKmenZbozi tkz WITH(NOLOCK) ON tkz.ID=tss.IDKmenZbozi  LEFT OUTER JOIN TabKmenZbozi_EXT tkze WITH(NOLOCK) ON tkze.ID=tkz.ID  LEFT OUTER JOIN TabDokladyZbozi tdz WITH(NOLOCK) ON tdz.ID = tpz.IDDoklad  WHERE (tdz.DruhPohybuZbo = 0 AND tkz.ID = (SELECT IDKmenZbozi FROM TabStavSkladu ts JOIN TabPohybyZbozi tp ON tp.IDZboSklad = ts.ID WHERE tp.ID = TabPohybyZbozi.ID) AND (tkze._Expirace_ = 0 OR tkze._Expirace_ IS NULL) AND (tkze._EXT_RS_expirace_ne = 0 OR tkze._EXT_RS_expirace_ne IS NULL))) = 1  AND  (SELECT tdz.DruhPohybuZbo  FROM TabPohybyZbozi tpz WITH(NOLOCK)  JOIN TabDokladyZbozi tdz WITH(NOLOCK) ON tdz.ID = tpz.IDDoklad  WHERE tpz.ID = TabPohybyZbozi.ID) = 0  THEN 8  ELSE NULL  END AS INT)
