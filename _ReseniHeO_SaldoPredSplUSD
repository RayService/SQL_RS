(CASE WHEN (CASE WHEN (EXISTS(SELECT * FROM TabSaldoDenPrehCM CM WITH(NOLOCK) INNER JOIN TabKodMen M WITH(NOLOCK) ON M.Kod = N'USD'  WHERE CM.IDSaldoDen = TabSaldoDenPreh.ID AND CM.Pozice = M.PoziceSaldo AND CM.CastkaCM_Splatno > CM.CastkaCM_Uhrazeno) OR TabSaldoDenPreh.[DatumUhrazeno] IS NULL)   THEN ISNULL((DATEDIFF(DAY,TabSaldoDenPreh.DatumSplatno,TabSaldoDenPreh.DatumDen)),0) ELSE ISNULL((DATEDIFF(DAY,TabSaldoDenPreh.DatumSplatno,TabSaldoDenPreh.DatumUhrazeno)),0) END)  <= 0 THEN (SELECT ISNULL(CM.CastkaCM_MD,0) - ISNULL(CM.CastkaCM_Dal,0) FROM TabSaldoDenPrehCM CM WITH(NOLOCK) INNER JOIN TabKodMen M WITH(NOLOCK) ON M.Kod = N'USD'  WHERE CM.IDSaldoDen = TabSaldoDenPreh.ID AND CM.Pozice = M.PoziceSaldo AND CM.CastkaCM_Splatno > CM.CastkaCM_Uhrazeno) ELSE 0 END)
