(  SELECT  (SUBSTRING(REPLACE(SUBSTRING(qmsa.[Popis1],1,255),(NCHAR(13) + NCHAR(10)),NCHAR(32)),1,255)) AS Popis1_255  FROM TabDokumenty td WITH(NOLOCK)    LEFT OUTER JOIN TabKontaktJednani tkj WITH(NOLOCK) ON EXISTS(SELECT*FROM TabDokumVazba V JOIN TabKontaktJednani KJ ON KJ.ID=V.IDTab AND KJ.ID=tkj.ID JOIN TabKategKontJed KK ON KK.Cislo=KJ.Kategorie WHERE V.IDDok=td.ID AND V.IdentVazby=1 AND KK.QMSAgenda=8)    LEFT OUTER JOIN TabQMSCis qmsc WITH(NOLOCK) ON EXISTS(SELECT*FROM TabDokumVazba V JOIN TabKontaktJednani KJ ON KJ.ID=V.IDTab AND KJ.IDCis1=qmsc.ID LEFT JOIN TabQMSCis C ON C.ID=KJ.IDCis1 JOIN TabKategKontJed KK ON KK.Cislo=KJ.Kategorie WHERE V.IDDok=td.ID AND V.IdentVazby=1 AND KK.QMSAgenda=8)    LEFT OUTER JOIN TabQMSAtributy qmsa ON tkj.ID=qmsa.IDKonJed  WHERE  (EXISTS(SELECT * FROM TabKontaktJednani KJ JOIN TabDokumVazba V ON V.IDDok=td.ID AND V.IdentVazby=1 AND V.IDTab=KJ.ID JOIN TabKategKontJed KTG ON KJ.Kategorie=KTG.Cislo WHERE KTG.QMSAgenda=8))AND td.ID=TabDokumenty.ID  )
