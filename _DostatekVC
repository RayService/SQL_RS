(SELECT CASE WHEN X.Mnoz >= PZ2.Mnozstvi*PZ2.PrepMnozstvi THEN 0 WHEN X.Mnoz = 0 THEN -2 ELSE -3 END    FROM (SELECT Mnoz=(CASE WHEN EXISTS(SELECT * FROM Tab_SDMater_VyrCislaKVyskladneni M WHERE M.IDPohybyZbozi=TabPohybyZbozi.ID)        THEN (SELECT ISNULL(SUM(VC.MnozBezVyd),0.0)            FROM Tab_SDMater_VyrCislaKVyskladneni M                                 INNER JOIN TabVyrCS VC ON (VC.ID=M.IDVyrCisla AND VC.MnozBezVyd>0.0)                              WHERE M.IDPohybyZbozi=TabPohybyZbozi.ID)                      ELSE (SELECT ISNULL(SUM(VC.MnozBezVyd),0.0)                              FROM TabPohybyZbozi PZ                                LEFT OUTER JOIN TabPohybyZbozi_EXT PZ_E ON (PZ_E.ID = PZ.ID)                                INNER JOIN TabVyrCS VC ON (VC.IDStavSkladu=PZ.IDZboSklad AND VC.MnozBezVyd>0.0)                                LEFT OUTER JOIN TabVyrCS_EXT VC_E ON (VC_E.ID=VC.ID)                              WHERE PZ.ID=TabPohybyZbozi.ID AND (ISNULL(PZ_E._PozadovanyIndexZmeny,'')='' OR PZ_E._PozadovanyIndexZmeny=VC_E._IndexZmeny))                      END)) X    INNER JOIN TabPohybyZbozi PZ2 ON (PZ2.ID=TabPohybyZbozi.ID)  )
