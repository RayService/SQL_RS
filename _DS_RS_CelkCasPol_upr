(CASE WHEN EXISTS  (SELECT  tp.ID  FROM TabPlan tp WITH(NOLOCK)  WHERE (tp.InterniZaznam=0 AND tp.mnozstvi=1 AND (tp.SkupinaPlanu LIKE N'%p100%' OR tp.SkupinaPlanu LIKE N'%XXX%') AND tp.ID=TabPlan.ID))  THEN  (((  SELECT  ISNULL(SUM(tpp.TBC_S / 3600.0),0)+ISNULL(SUM(tpp.Kusy_zad * tpp.TAC_S / 3600.0),0)  FROM TabPrPostup AS tpp WITH(NOLOCK)    LEFT OUTER JOIN TabPrikaz tp WITH(NOLOCK) ON tpp.IDPrikaz=tp.ID    LEFT OUTER JOIN TabCPraco tcp WITH(NOLOCK) ON tpp.Pracoviste=tcp.ID    LEFT OUTER JOIN TabPlan tpl WITH(NOLOCK) ON tpl.ID = tp.IDPlan  WHERE ((tpp.IDOdchylkyDo IS NULL) AND tpl.ID = TabPlan.ID AND tcp.IDTabStrom LIKE '200%')  )  +  (  SELECT  ISNULL(SUM(tppp.TBC_S / 3600.0),0)+ISNULL(SUM(tppp.Kusy_zad * tppp.TAC_S / 3600.0),0)  FROM TabPlan tp WITH(NOLOCK)    LEFT OUTER JOIN TabPlanPrikaz tpp WITH(NOLOCK) ON tpp.IDPlan = tp.ID    LEFT OUTER JOIN TabPlanPrPostup tppp WITH(NOLOCK) ON tppp.IDPlanPrikaz = tpp.ID    LEFT OUTER JOIN TabCPraco tcp WITH(NOLOCK) ON tppp.Pracoviste=tcp.ID  WHERE tcp.IDTabStrom LIKE '200%' AND tp.ID = TabPlan.ID  ))  *2)  ELSE  ((  SELECT  ISNULL(SUM(tpp.TBC_S / 3600.0),0)+ISNULL(SUM(tpp.Kusy_zad * tpp.TAC_S / 3600.0),0)  FROM TabPrPostup AS tpp WITH(NOLOCK)    LEFT OUTER JOIN TabPrikaz tp WITH(NOLOCK) ON tpp.IDPrikaz=tp.ID    LEFT OUTER JOIN TabCPraco tcp WITH(NOLOCK) ON tpp.Pracoviste=tcp.ID    LEFT OUTER JOIN TabPlan tpl WITH(NOLOCK) ON tpl.ID = tp.IDPlan  WHERE ((tpp.IDOdchylkyDo IS NULL) AND tpl.ID = TabPlan.ID AND tcp.IDTabStrom LIKE '200%')  )  +  (  SELECT  ISNULL(SUM(tppp.TBC_S / 3600.0),0)+ISNULL(SUM(tppp.Kusy_zad * tppp.TAC_S / 3600.0),0)  FROM TabPlan tp WITH(NOLOCK)    LEFT OUTER JOIN TabPlanPrikaz tpp WITH(NOLOCK) ON tpp.IDPlan = tp.ID    LEFT OUTER JOIN TabPlanPrPostup tppp WITH(NOLOCK) ON tppp.IDPlanPrikaz = tpp.ID    LEFT OUTER JOIN TabCPraco tcp WITH(NOLOCK) ON tppp.Pracoviste=tcp.ID  WHERE tcp.IDTabStrom LIKE '200%' AND tp.ID = TabPlan.ID  ))END)
