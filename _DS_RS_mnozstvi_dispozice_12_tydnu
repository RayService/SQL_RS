(  TabStavSkladu.MnozSPrij-  (ISNULL((SELECT ISNULL(PKZ.BlokovanoProVyrobu,0)  FROM  TabParametryKmeneZbozi PKZ WITH(NOLOCK) WHERE TabStavSkladu.IDKmenZbozi=PKZ.IDKmenZbozi AND TabStavSkladu.IDSklad = :__SKLAD),0)  +  TabStavSkladu.Rezervace  +  ISNULL((SELECT SUM(tppkv.mnoz_zad)   FROM TabStavSkladu tss WITH(NOLOCK)  LEFT OUTER JOIN TabKmenZbozi tkz WITH(NOLOCK) ON tkz.ID = tss.IDKmenZbozi AND tss.IDSklad = :__SKLAD  LEFT OUTER JOIN TabPlanPrKVazby tppkv WITH(NOLOCK) ON tppkv.nizsi = tkz.ID  LEFT OUTER JOIN TabPlan tp WITH(NOLOCK) ON tp.ID = tppkv.IDPlan  LEFT OUTER JOIN TabRadyPlanu trp WITH(NOLOCK) ON trp.Rada = tp.Rada  LEFT OUTER JOIN TabPlanPrikaz tplpr WITH(NOLOCK) ON tplpr.ID=tppkv.IDPlanPrikaz  WHERE tkz.ID = TabStavSkladu.IDKmenZbozi AND TabStavSkladu.IDSklad = :__SKLAD AND trp.ZahrnoutDoBilancovaniBudPoh = 2 AND (tplpr.Plan_zadani>=GETDATE() AND tplpr.Plan_zadani<=GETDATE()+112)),0))  )
